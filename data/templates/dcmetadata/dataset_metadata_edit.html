{% extends "admin/admin_base_site.html" %}
{% load i18n admin_static admin_modify %}
{% load custom_tag %}


{% block extrahead %}
	{{ block.super }}
	
		<!-- JQuery -->
		<script src="{{MEDIA_URL}}js/third_party/jquery-1.3.2.min.js" type="text/javascript"></script>
		<!-- MooTools -->
		<script src="https://ajax.googleapis.com/ajax/libs/mootools/1.4.5/mootools-yui-compressed.js" type="text/javascript"></script>
		<!-- Customized JS -->
		<!-- JQuery Dynamic Formset -->
		<script src="{{MEDIA_URL}}js/custom/jquery.formset.js" type="text/javascript"></script>
		<link href="{{ MEDIA_URL }}css/third_party/JQuery/default.css" rel="stylesheet" type="text/css" media="screen" />
		
		<!-- CSS -->
		<style type="text/css">
			.form-container table{
				border-collapse: seperate;
			}
			.delete-link{
				float:right;
				padding-left:18px;
				margin-right:10%;
				background:url({{ MEDIA_URL }}images/icon_delete.gif) no-repeat left center;
			}
			.form-submit-buttons{
				float:left;
			}
			#save-button{
				border:2px solid #487909;
				background: url({{ MEDIA_URL }}images/default-bg.gif) bottom repeat-x;
				font-weight: bold;
				color:white;
			}
			
			.form-help-text{
				float:right;
				margin-left:10px;
				padding-left:20px;
				background:url({{ MEDIA_URL }}images/icon_hint.png) no-repeat left center;
				display: block;
				-webkit-margin-before: 0px;
				-webkit-margin-after: 0px;
				-webkit-margin-start: 0px;
				-webkit-margin-end: 0px;
				height: 18px !important;
				margin-top:3px !important;
				margin-bottom: -30px !important;
			}
			.add-row {
				padding-left:18px;
				background:url({{ MEDIA_URL }}images/add.png) no-repeat left center;
			}
			.delete-row {
				float:right;
				display:block;
				margin-left:4px;
				margin-top:10px;
				padding-left:18px;
				background:url({{ MEDIA_URL }}images/delete.png) no-repeat left center;
			}
			#header-row-input{
				width:30px;
			}
			.dynamic-fields-form th {
				text-align:right;
				font-weight:bold;
			}
			.dynamic-fields-form td span img {
				vertical-align:middle;
				border:0;
			}
			
			.dynamic-other-form th {
				text-align:right;
				font-weight:bold;
			}
			.dynamic-other-form td span img {
				vertical-align:middle;
				border:0;
			}
			
			table{
				padding: 10px;
				margin: 20px;
				width: 90%;
			}
			
			tr {
				border: 0px solid;
				border-top-color: #DDDDDD;
				border-top-width: 1px;
			}
			
			fieldset table{
				border-right: 0px solid;
			}
			
			.errornote{
				font-size: 12px !important;
				display: block;
				padding: 4px 5px 4px 25px;
				margin: 0 0 3px 0;
				border: 1px solid red;
				color: red;
				background: #FFC url({{ MEDIA_URL }}images/icon_error.png) 5px .3em no-repeat;
				line-height: 14px;
			}
			
			.errorlist li{
				font-size: 12px !important;
				display: block;
				padding: 4px 5px 4px 25px;
				margin: 0 0 3px 0;
				border: 1px solid red;
				color: white;
				background: red url({{ MEDIA_URL }}images/icon_errormsg.png) 5px .3em no-repeat;
				line-height: 14px;
			}
			
			ul{
				display: block;
				-webkit-margin-before: 0px;
				-webkit-margin-after: 0px;
				-webkit-margin-start: 0px;
				-webkit-margin-end: 0px;
				-webkit-padding-start: 0px;
			}
		</style>
		
	<!-- Extra JS and CSS for resusing admin FilterSelectMultiple widget -->
	<script type="text/javascript" src="{% setting 'APP_SERVER_URL' %}/admin/jsi18n/"></script>
	<script type="text/javascript" src="{{ MEDIA_URL }}admin/js/jquery.init.js"></script>
	<script type="text/javascript" src="{{ MEDIA_URL }}admin/js/jquery.js"></script>
	<script type="text/javascript" src="{{ MEDIA_URL }}admin/js/jquery.min.js"></script>
	<script type="text/javascript" src="{{ MEDIA_URL }}admin/js/actions.js"></script>
	<script type="text/javascript" src="{{ MEDIA_URL }}admin/js/core.js"></script>
	<script type="text/javascript" src="{{ MEDIA_URL }}admin/js/RelatedObjectLookups.js"></script>
	<script type="text/javascript" src="{{ MEDIA_URL }}admin/js/SelectBox.js"></script>
	<script type="text/javascript" src="{{ MEDIA_URL }}admin/js/SelectFilter2.js"></script>
{% endblock %}

{% block title %}Dataset ID {{dataset_id}} | {% trans 'Data Commons Source Data Metadata Management' %}{% endblock %}

{% block breadcrumbs %}
<div class="breadcrumbs">
<a href="{% setting 'APP_SERVER_URL' %}/dcmetadata/home/">{% trans 'Home' %}</a>
&rsaquo; <a href="{% setting 'APP_SERVER_URL' %}/admin/dcmetadata/">App:Dcmetadata Administration</a>
&rsaquo; <a href="{% setting 'APP_SERVER_URL' %}/admin/dcmetadata/dataset/">Datasets</a>
&rsaquo; <a href="{% setting 'APP_SERVER_URL' %}/admin/dcmetadata/dataset/{{ dataset_id }}/">Dataset ID: {{dataset_id}}</a>
{% if is_add_new_metadata %}
&rsaquo; Add Dataset Metadata
{% else %}
&rsaquo; Edit Dataset Metadata
{% endif %}
</div>
{% endblock %}

{% block content %}
<div id="content-main">
	<br/><hr><br/>
	<h1>Dataset ID: {{dataset_id}} - Metadata</h1>
	<br/><br/>
	<form id="myDynamicForm" method="post" action="">{% csrf_token %}
	{% if form_has_errors %}
		<p class="errornote">Please correct the errors below.</p>
	{% endif %}
	<fieldset class="module aligned">
		<table class="form-container" border="0" cellpadding="0" cellspacing="5">
			<tbody>
				<tr>
					<th scope="row">{{ dataset_metadata_form.fields.label }}</th>
					<td>
						<p> Use the arrow below or double click to select/deselect.<br/>Hold down "Control", or "Command" on a Mac, to select more than one.</p>
						<p>{{ dataset_metadata_form.fields.errors }}</p>
						{{ dataset_metadata_form.fields }}
					</td>
				</tr>
				<tr>
					<th scope="row">{{ dataset_metadata_form.display_name.label }}</th>
					<td>
						<p>{{ dataset_metadata_form.display_name.errors }}</p>
						{{ dataset_metadata_form.display_name }}
					</td>
				</tr>
				<tr>
					<th scope="row">{{ dataset_metadata_form.pkey.label }}</th>
					<td>
						<p> Use the arrow below or double click to select/deselect.<br/>Hold down "Control", or "Command" on a Mac, to select more than one.</p>
						<p>{{ dataset_metadata_form.pkey.errors }}</p>
						{{ dataset_metadata_form.pkey }}
					</td>
				</tr>
				<tr>
					<th scope="row">{{ dataset_metadata_form.gkey_main.label }}</th>
					<td>
						<p>{{ dataset_metadata_form.gkey_main.errors }}</p>
						{{ dataset_metadata_form.gkey_main }}
					</td>
				</tr>
				<tr>
					<th scope="row">{{ dataset_metadata_form.gkey_spatial.label }}</th>
					<td>
						<p>{{ dataset_metadata_form.gkey_spatial.errors }}</p>
						{{ dataset_metadata_form.gkey_spatial }}
					</td>
				</tr>
				{{ dataset_metadata_fkey_formset.management_form }}
				{% for form in dataset_metadata_fkey_formset %}
					<tr>
						<th scope="row">{{ form.foreign_key.label }}</th>
						<td>{{ form.foreign_key.errors }}{{ form.foreign_key }}</td>
					</tr>
					<tr>
						<th scope="row">{{ form.reference_key.label }}</th>
						<td>{{ form.reference_key.errors }}{{ form.reference_key }}</td>
					</tr>
				{% endfor %}				
			</tbody>
		</table>
	</fieldset>
	<div class="form-submit-buttons">
		<p>
			<input type="submit" name="save_continue" value="Save and continue editing" />
			<input type="submit" name="save" id="save-button" value="Save">
		</p>
	</div>
	</form>
	<br/>
	{% if not is_add_new_metadata %}
		<a class="delete-link" href="../delete_confirm">Delete Dataset</a>
	{% endif %}
</div>
{% endblock %}

{% block bottom_javascript %}
	<!-- JavaScript for using Django Admin FilteredSelectMultiple widget -->
	<script type="text/javascript">
		addEvent(window, "load", function(e) {
			SelectFilter.init("id_fields", "fields", 0, "/static/datacommons/admin/");
			SelectFilter.init("id_pkey", "pkey", 0, "/static/datacommons/admin/");
		});
	</script>
{% endblock %}